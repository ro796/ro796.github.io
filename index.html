<?php
include 'config.php'; // include admin email

if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $to = $admin_email; 
    $subject = "üõí New Order from Moaiad Store";

    $message = "New Order Details:\n\n";
    foreach ($_POST as $key => $value) {
        if ($key == "cart") {
            $cartItems = json_decode($value, true);
            $message .= "Cart:\n";
            foreach ($cartItems as $item) {
                $message .= "- " . $item["product"] . " : $" . $item["price"] . "\n";
            }
        } else {
            $message .= ucfirst($key) . ": " . $value . "\n";
        }
    }

    // send mail
    mail($to, $subject, $message);

    echo "<h2 style='text-align:center; font-family:Arial'>‚úÖ Order Confirmed! Details sent to admin email</h2>";
    exit;
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Moaiad Store</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
</head>
<body class="bg-gray-50 text-gray-900">

<!-- Navbar -->
<header class="bg-gray-900 text-white p-4 flex justify-between items-center sticky top-0 z-50">
  <h1 class="text-2xl font-bold">Moaiad Store</h1>
  <nav>
    <button onclick="document.getElementById('products').scrollIntoView({behavior:'smooth'})"
      class="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded-lg">Shop Now</button>
    <button onclick="toggleCart()" class="relative ml-4 bg-green-500 hover:bg-green-600 px-4 py-2 rounded-lg">
      üõí Cart (<span id="cart-count">0</span>)
    </button>
  </nav>
</header>

<!-- Products -->
<section id="products" class="py-12 px-6">
  <h2 class="text-4xl font-bold text-center mb-12">Our Products</h2>

  <!-- iPhone Covers -->
  <h3 class="text-2xl font-semibold mb-6">iPhone Covers</h3>
  <div class="grid md:grid-cols-3 gap-6 mb-12">
    <div class="bg-white rounded-xl shadow-lg p-4 text-center">
      <img src="https://via.placeholder.com/300" alt="iPhone Cover" class="mx-auto rounded-lg mb-4">
      <h4 class="font-bold">iPhone Cover 1</h4>
      <p class="text-gray-600 mb-2">$150</p>
      <button onclick="addToCart('iPhone Cover 1',150)" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg">Add to Cart</button>
    </div>
    <div class="bg-white rounded-xl shadow-lg p-4 text-center">
      <img src="https://via.placeholder.com/300" alt="iPhone Cover" class="mx-auto rounded-lg mb-4">
      <h4 class="font-bold">iPhone Cover 2</h4>
      <p class="text-gray-600 mb-2">$170</p>
      <button onclick="addToCart('iPhone Cover 2',170)" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg">Add to Cart</button>
    </div>
  </div>

  <!-- Samsung Covers -->
  <h3 class="text-2xl font-semibold mb-6">Samsung Covers</h3>
  <div class="grid md:grid-cols-3 gap-6 mb-12">
    <div class="bg-white rounded-xl shadow-lg p-4 text-center">
      <img src="https://via.placeholder.com/300" alt="Samsung Cover" class="mx-auto rounded-lg mb-4">
      <h4 class="font-bold">Samsung Cover 1</h4>
      <p class="text-gray-600 mb-2">$120</p>
      <button onclick="addToCart('Samsung Cover 1',120)" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg">Add to Cart</button>
    </div>
    <div class="bg-white rounded-xl shadow-lg p-4 text-center">
      <img src="https://via.placeholder.com/300" alt="Samsung Cover" class="mx-auto rounded-lg mb-4">
      <h4 class="font-bold">Samsung Cover 2</h4>
      <p class="text-gray-600 mb-2">$140</p>
      <button onclick="addToCart('Samsung Cover 2',140)" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg">Add to Cart</button>
    </div>
  </div>

  <!-- Fancy Covers -->
  <h3 class="text-2xl font-semibold mb-6">Fancy Covers</h3>
  <div class="grid md:grid-cols-3 gap-6">
    <div class="bg-white rounded-xl shadow-lg p-4 text-center">
      <img src="https://via.placeholder.com/300" alt="Fancy Cover" class="mx-auto rounded-lg mb-4">
      <h4 class="font-bold">Fancy Cover 1</h4>
      <p class="text-gray-600 mb-2">$200</p>
      <button onclick="addToCart('Fancy Cover 1',200)" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg">Add to Cart</button>
    </div>
  </div>
</section>

<!-- Cart -->
<div id="cart" class="fixed right-6 top-20 w-96 bg-white shadow-2xl rounded-xl p-4 hidden z-50">
  <h3 class="text-xl font-bold mb-4">Your Cart</h3>
  <ul id="cart-items" class="space-y-2 mb-4"></ul>
  <p class="font-bold">Total: $<span id="cart-total">0</span></p>
  
  <!-- Checkout Form -->
  <form method="POST" class="mt-4 space-y-3">
    <input type="hidden" name="cart" id="cart-data">

    <input type="text" name="name" placeholder="Full Name" class="w-full p-2 border rounded" required>
    <input type="email" name="email" placeholder="Email" class="w-full p-2 border rounded" required>
    <input type="text" name="phone" placeholder="Phone Number" class="w-full p-2 border rounded" required>
    <input type="text" name="address" placeholder="Shipping Address" class="w-full p-2 border rounded" required>

    <select name="payment" id="payment-method" class="w-full p-2 border rounded" onchange="toggleCardForm()" required>
      <option value="">Select Payment Method</option>
      <option value="Cash on Delivery">Cash on Delivery</option>
      <option value="Visa Card">Visa Card</option>
    </select>

    <!-- Visa Form -->
    <div id="card-form" class="hidden space-y-2">
      <input type="text" name="card_number" placeholder="Card Number" class="w-full p-2 border rounded">
      <input type="text" name="expiry" placeholder="Expiry Date (MM/YY)" class="w-full p-2 border rounded">
      <input type="text" name="cvv" placeholder="CVV" class="w-full p-2 border rounded">
    </div>

    <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white py-2 rounded-lg">Confirm Order</button>
  </form>
</div>

<!-- Footer -->
<footer class="bg-gray-900 text-white text-center py-6 mt-12">
  <p>¬©Ô∏è 2025 Moaiad Store | All Rights Reserved</p>
</footer>

<script>
let cart = [];

function addToCart(product, price) {
  cart.push({product, price});
  updateCart();
  gsap.from("#cart-count", {scale:1.5, duration:0.3, ease:"bounce"});
}

function updateCart() {
  let cartItems = document.getElementById("cart-items");
  let cartTotal = document.getElementById("cart-total");
  let cartCount = document.getElementById("cart-count");
  let cartData = document.getElementById("cart-data");

  cartItems.innerHTML = "";
  let total = 0;
  cart.forEach((item, index) => {
    total += item.price;
    cartItems.innerHTML += `
      <li class="flex justify-between items-center bg-gray-100 px-3 py-2 rounded-lg">
        <span>${item.product} - $${item.price}</span>
        <button onclick="removeFromCart(${index})" class="text-red-600 font-bold">‚úñ</button>
      </li>
    `;
  });
  cartTotal.innerText = total;
  cartCount.innerText = cart.length;
  cartData.value = JSON.stringify(cart);
}

function removeFromCart(index) {
  cart.splice(index,1);
  updateCart();
}

function toggleCart() {
  let cartBox = document.getElementById("cart");
  cartBox.classList.toggle("hidden");
  gsap.from(cartBox, {y:-50, opacity:0, duration:0.5});
}

function toggleCardForm() {
  let payment = document.getElementById("payment-method").value;
  let cardForm = document.getElementById("card-form");
  if(payment === "Visa Card"){
    cardForm.classList.remove("hidden");
  } else {
    cardForm.classList.add("hidden");
  }
}
</script>

</body>
</html>
